<div class="card" style="margin-top:1rem;">
  <h3 class="card-title">Movimientos del turno</h3>
  <div style="max-height: 380px; overflow-y: auto; overscroll-behavior: contain;">
    <% if @transactions.any? %>
      <table class="table" style="position: relative;">
        <thead style="position: sticky; top: 0; background: rgba(0,0,0,.15); backdrop-filter: blur(2px);">
          <tr><th>Hora</th><th>Detalle</th><th>MÃ©todo</th><th>Monto</th></tr>
        </thead>
        <tbody>
          <% @transactions.each do |t| %>
            <tr>
              <td><%= t[:at]&.in_time_zone&.strftime("%H:%M") %></td>
              <td><%= t[:label] %></td>
              <td><%= t[:payment_method] %></td>
              <td><%= number_to_currency(t[:amount_cents].to_i / 100.0, unit: "MXN $", precision: 2) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-muted">Sin movimientos en el turno.</p>
    <% end %>
  </div>
</div>

<div class="card" style="margin-top:1rem;">
  <h3 class="card-title">Productos vendidos (detalle del turno)</h3>
  <div style="max-height: 380px; overflow-y: auto; overscroll-behavior: contain;">
    <% if @sold_by_product.present? && @sold_by_product.any? %>
      <table class="table" style="position: relative;">
        <thead style="position: sticky; top: 0; background: rgba(0,0,0,.15); backdrop-filter: blur(2px);">
          <tr>
            <th>Producto</th>
            <th style="text-align:right;">Vendido (uds)</th>
            <th style="text-align:right;">Ingresos</th>
            <th style="text-align:right;">Stock restante</th>
          </tr>
        </thead>
        <tbody>
          <% @sold_by_product.each do |row| %>
            <tr>
              <td><%= row[:product_name] %></td>
              <td style="text-align:right;"><%= row[:sold_qty] %></td>
              <td style="text-align:right;"><%= number_to_currency(row[:revenue_cents].to_i / 100.0, unit: "MXN $", precision: 2) %></td>
              <td style="text-align:right;"><%= row[:remaining_stock] %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-muted">No se vendieron productos en el turno.</p>
    <% end %>
  </div>
</div>

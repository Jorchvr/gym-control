<%= stylesheet_link_tag "main_panel", media: "all", "data-turbo-track": "reload" %>

<div class="ticket-page">
  <div class="ticket-wrapper">
    <div class="ticket-card">
      <!-- HEADER -->
      <div class="ticket-header">
        <div class="ticket-logo-wrap">
          <%= image_tag "logo.png", alt: "PowerGym", class: "ticket-logo" %>
        </div>
        <div class="ticket-header-text">
          <p class="ticket-title">PowerGym</p>
          <p class="ticket-subtitle">CORTE DEL D√çA</p>
          <p class="ticket-date">
            <%= @date&.strftime("%Y-%m-%d ‚Ä¢ %H:%M") %>
          </p>
        </div>
      </div>

      <!-- USUARIO -->
      <div class="ticket-section ticket-section--user">
        <div class="ticket-row">
          <div class="ticket-row-left ticket-label">Usuario</div>
          <div class="ticket-row-right ticket-text-strong"><%= @user_name %></div>
        </div>
      </div>

      <!-- RESUMEN GENERAL -->
      <div class="ticket-section">
        <p class="ticket-section-title">RESUMEN GENERAL</p>

        <div class="ticket-row">
          <div class="ticket-row-left">Operaciones totales</div>
          <div class="ticket-row-right ticket-mono"><%= @ops_count.to_i %></div>
        </div>

        <div class="ticket-row">
          <div class="ticket-row-left">Ventas de membres√≠a</div>
          <div class="ticket-row-right ticket-mono">
            MXN <%= number_to_currency(@member_cents.to_i / 100.0, unit: "", precision: 2) %>
          </div>
        </div>

        <div class="ticket-row">
          <div class="ticket-row-left">Ventas de tienda</div>
          <div class="ticket-row-right ticket-mono">
            MXN <%= number_to_currency(@store_cents.to_i / 100.0, unit: "", precision: 2) %>
          </div>
        </div>

        <div class="ticket-row ticket-row--negative">
          <div class="ticket-row-left">Ajustes / ventas negativas</div>
          <div class="ticket-row-right ticket-mono">
            MXN <%= number_to_currency(@adjustments_cents.to_i / 100.0, unit: "", precision: 2) %>
          </div>
        </div>

        <div class="ticket-row ticket-row--total ticket-text-strong">
          <div class="ticket-row-left">Total del d√≠a</div>
          <div class="ticket-row-right ticket-mono">
            MXN <%= number_to_currency(@total_cents.to_i / 100.0, unit: "", precision: 2) %>
          </div>
        </div>
      </div>

      <!-- M√âTODOS DE PAGO -->
      <div class="ticket-section">
        <p class="ticket-section-title">M√âTODOS DE PAGO</p>

        <div class="ticket-row">
          <div class="ticket-row-left">Efectivo</div>
          <div class="ticket-row-right ticket-mono">
            MXN <%= number_to_currency(@by_method["cash"].to_i / 100.0, unit: "", precision: 2) %>
          </div>
        </div>

        <div class="ticket-row">
          <div class="ticket-row-left">Transferencia</div>
          <div class="ticket-row-right ticket-mono">
            MXN <%= number_to_currency(@by_method["transfer"].to_i / 100.0, unit: "", precision: 2) %>
          </div>
        </div>
      </div>

      <!-- ACTIVIDAD DE CLIENTES -->
      <div class="ticket-section">
        <p class="ticket-section-title">ACTIVIDAD DE CLIENTES</p>

        <div class="ticket-row">
          <div class="ticket-row-left">Entradas (check-ins)</div>
          <div class="ticket-row-right ticket-mono"><%= @checkins_today.to_i %></div>
        </div>

        <div class="ticket-row">
          <div class="ticket-row-left">Nuevos clientes</div>
          <div class="ticket-row-right ticket-mono"><%= @new_clients_today.to_i %></div>
        </div>
      </div>

      <!-- PRODUCTOS VENDIDOS (TODOS) -->
      <div class="ticket-section">
        <p class="ticket-section-title">PRODUCTOS VENDIDOS</p>

        <% if @sold_by_product.blank? %>
          <p class="ticket-empty">No hay productos vendidos en este turno.</p>
        <% else %>
          <% @sold_by_product.each do |row| %>
            <div class="ticket-row">
              <div class="ticket-row-left">
                <%= row[:product_name] %>
                <% if row[:sold_qty].to_i > 1 %>
                  x<%= row[:sold_qty].to_i %>
                <% end %>
              </div>
              <div class="ticket-row-right ticket-mono">
                MXN <%= number_to_currency(row[:revenue_cents].to_i / 100.0, unit: "", precision: 2) %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- FOOTER -->
      <div class="ticket-footer">
        <p class="ticket-thanks">¬°Gracias por tu trabajo hoy! üí™</p>
        <p class="ticket-generated-at">
          Corte generado el <%= Time.zone.now.strftime("%Y-%m-%d ¬∑ %H:%M") %>
        </p>

        <div class="ticket-barcode">
          <div class="ticket-barcode-lines">
            <% 22.times do |i| %>
              <% if i.even? %>
                <span class="ticket-bar-line"></span>
              <% else %>
                <span class="ticket-bar-line ticket-bar-line--thin"></span>
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

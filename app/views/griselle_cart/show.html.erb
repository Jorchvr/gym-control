  <!-- Carrito -->
  <div class="mini-cart mini-cart--short" style="margin-top:16px;">
    <h3 class="card-title">Carrito</h3>
    <% if @cart.blank? %>
      <p class="text-muted">No hay items.</p>
    <% else %>
      <% total_cents = 0 %>

      <% collection = @cart.is_a?(Hash) ? @cart.values : Array(@cart) %>
      <% collection.each do |li| %>
        <% li = li.is_a?(Hash) ? li.with_indifferent_access : {} %>

        <% # precio en centavos: usa :price_cents; si no hay, convierte :amount (pesos) a centavos %>
        <% unit_cents =
             if li[:price_cents].present?
               li[:price_cents].to_i
             else
               (BigDecimal(li[:amount].to_s) * 100).to_i rescue 0
             end %>

        <% qty = (li[:qty].presence || 1).to_i %>
        <% line_cents = unit_cents * qty
           total_cents += line_cents %>

        <% line_id = li[:id] || li[:line_id] || li[:product_id] || li[:key] || li[:sku] %>
        <% name    = li[:name] || li[:description] || "Item" %>

        <div class="cart-line" style="display:flex; justify-content:space-between; align-items:center; padding:.4rem 0; border-bottom:1px dashed rgba(255,255,255,.06);">
          <div>
            <strong><%= name %></strong> <em>x<%= qty %></em>
            <div class="text-muted">($<%= (unit_cents/100.0).round(2) %> c/u)</div>
          </div>
          <div style="display:flex; gap:6px; align-items:center;">
            <span>$<%= (line_cents/100.0).round(2) %></span>
            <%= button_to "−",
                  decrement_griselle_cart_path,
                  method: :post,
                  params: { line_id: line_id },
                  class: "btn btn-sm btn-icon",
                  form: { data: { turbo: false } } %>

            <%= button_to "+",
                  increment_griselle_cart_path,
                  method: :post,
                  params: { line_id: line_id },
                  class: "btn btn-primary btn-sm btn-icon",
                  form: { data: { turbo: false } } %>

            <%= button_to "Quitar",
                  remove_griselle_cart_path,
                  method: :post,
                  params: { line_id: line_id },
                  class: "btn btn-sm",
                  form: { data: { turbo: false } } %>
          </div>
        </div>
      <% end %>

      <%= form_with url: checkout_griselle_cart_path, method: :post, local: true do |f| %>
        <div class="mb-4" style="margin-top:12px;">
          <label class="label">Método de pago:</label>
          <div class="radio-row">
            <label><input type="radio" name="payment_method" value="cash" checked> Efectivo</label>
            <label style="margin-left:1rem;"><input type="radio" name="payment_method" value="transfer"> Transferencia</label>
          </div>
        </div>
        <div class="cart-total-row" style="display:flex; justify-content:space-between; align-items:center;">
          <div class="total">
            Total: $<%= (total_cents/100.0).round(2) %>
          </div>
          <%= f.submit "Cobrar", class: "btn btn-primary" %>
        </div>
      <% end %>
    <% end %>
  </div>
